<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tabelas de Cores e Tamanhos</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background-color: #f4f4f4;
      text-align: center;
      padding: 12px;
      margin: 0;
    }

    .app-container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }

    .app-header {
      margin-bottom: 12px;
    }

    .app-header h2 {
      font-size: 24px;
      margin: 8px 0;
    }

    .app-actions {
      margin: 12px 0 20px 0;
    }

    .app-actions button {
      background-color: #007BFF;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 14px 20px;
      font-size: 16px;
      cursor: pointer;
      touch-action: manipulation;
      width: 100%;
      max-width: 100%;
      min-height: 48px;
      font-weight: 600;
    }

    .app-actions button:active {
      opacity: 0.8;
      transform: scale(0.98);
    }

    .cards-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }

    .card {
      background: white;
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);
      text-align: left;
    }

    .card-header {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 16px;
    }

    .model-title {
      font-size: 20px;
      font-weight: bold;
      border: none;
      border-bottom: 3px solid #007BFF;
      padding: 12px 8px;
      outline: none;
      width: 100%;
      min-height: 48px;
    }

    .size-inputs {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .size-input-wrapper {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .size-input-wrapper label {
      display: block;
      font-weight: bold;
      font-size: 18px;
      text-align: center;
      color: #007BFF;
    }

    .size-inputs input[type="number"] {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      text-align: center;
      border: 2px solid #007BFF;
      border-radius: 8px;
      touch-action: manipulation;
      min-height: 48px;
    }

    .card-actions {
      display: flex;
      gap: 10px;
      flex-direction: column;
    }

    .card-actions button {
      background-color: #28a745;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 14px 16px;
      font-size: 16px;
      cursor: pointer;
      touch-action: manipulation;
      width: 100%;
      min-height: 48px;
      font-weight: 600;
    }

    .card-actions button:active {
      opacity: 0.8;
      transform: scale(0.98);
    }

    .card-actions button.secondary {
      background-color: #6c757d;
    }

    /* Quantity controls */
    .qty-control {
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
    }

    .qty-control .btn-qty {
      background: #007BFF;
      color: white;
      border: none;
      border-radius: 8px;
      width: 44px;
      height: 44px;
      line-height: 44px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      padding: 0;
      touch-action: manipulation;
      flex-shrink: 0;
    }

    .qty-control .btn-qty:active {
      opacity: 0.8;
      transform: scale(0.95);
    }

    .qty-control .qty-input {
      width: 70px;
      padding: 10px;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      border: 2px solid #ddd;
      border-radius: 8px;
      min-height: 44px;
    }

    /* Controles de quantidade dentro da tabela */
    td .qty-control {
      flex-wrap: nowrap;
      width: 100%;
      justify-content: center;
      flex-direction: row !important;
      gap: 3px !important;
    }

    td .qty-control .btn-qty {
      width: 26px;
      height: 26px;
      line-height: 26px;
      font-size: 14px;
      flex-shrink: 0;
      border-radius: 5px;
    }

    td .qty-control .qty-input {
      width: 40px;
      padding: 3px 2px;
      font-size: 13px;
      min-height: 26px;
      flex-shrink: 0;
      border-radius: 5px;
      border-width: 1px;
    }

    .table-wrapper {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin: 0 -16px;
      padding: 0 16px;
    }

    .table-fixed {
      table-layout: fixed;
      min-width: 100%;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 12px 0;
      font-size: 14px;
    }

    th,
    td {
      border: 1px solid #ddd;
      padding: 10px 6px;
      text-align: center;
      vertical-align: middle;
      overflow: visible;
    }

    th {
      background-color: #007BFF;
      color: white;
      font-weight: 600;
      font-size: 13px;
    }

    /* Garantir larguras adequadas para cada coluna */
    .table-fixed th:nth-child(1),
    .table-fixed td:nth-child(1) {
      min-width: 120px;
      width: 35%;
    }

    .table-fixed th:nth-child(2),
    .table-fixed td:nth-child(2) {
      min-width: 140px;
      width: 30%;
    }

    .table-fixed th:nth-child(3),
    .table-fixed td:nth-child(3),
    .table-fixed th:nth-child(4),
    .table-fixed td:nth-child(4),
    .table-fixed th:nth-child(5),
    .table-fixed td:nth-child(5),
    .table-fixed th:nth-child(6),
    .table-fixed td:nth-child(6) {
      width: 8.75%;
      min-width: 60px;
    }

    .total-row,
    .grand-total-row {
      font-weight: bold;
      background-color: #e9ecef;
    }

    .btn-delete-color {
      background-color: #dc3545;
      color: white;
      border: none;
      border-radius: 6px;
      width: 36px;
      height: 36px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      touch-action: manipulation;
      padding: 0;
      line-height: 1;
      flex-shrink: 0;
    }

    .btn-delete-color:active {
      opacity: 0.8;
      transform: scale(0.95);
    }

    .color-name-cell {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      width: 100%;
      min-height: 44px;
    }

    .color-name-cell span {
      flex: 1;
      text-align: left;
      word-break: break-word;
      overflow-wrap: anywhere;
    }

    .add-color-section {
      margin-top: 16px;
      padding: 16px;
      background: #f8f9fa;
      border-radius: 10px;
    }

    .add-color-section h3 {
      margin: 0 0 12px 0;
      font-size: 18px;
    }

    .add-color-section input[type="text"] {
      width: 100%;
      padding: 12px;
      border: 2px solid #007BFF;
      border-radius: 8px;
      font-size: 16px;
      margin-bottom: 10px;
      min-height: 48px;
    }

    .add-color-section button {
      width: 100%;
      background-color: #007BFF;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 14px 16px;
      cursor: pointer;
      touch-action: manipulation;
      font-size: 16px;
      min-height: 48px;
      font-weight: 600;
    }

    .add-color-section button:active {
      opacity: 0.8;
      transform: scale(0.98);
    }

    /* Estilos específicos para telas maiores (tablet e desktop) */
    @media (min-width: 768px) {
      body {
        padding: 24px;
      }

      .app-header h2 {
        font-size: 28px;
      }

      .cards-grid {
        grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
      }

      .card {
        padding: 24px;
      }

      .size-inputs {
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
      }

      .size-input-wrapper label {
        font-size: 16px;
      }

      .card-actions {
        flex-direction: row;
      }

      .card-actions button {
        flex: 1;
      }

      .app-actions button {
        max-width: 400px;
      }

      .add-color-section {
        display: flex;
        align-items: flex-end;
        gap: 12px;
      }

      .add-color-section h3 {
        display: none;
      }

      .add-color-section input[type="text"] {
        flex: 1;
        margin-bottom: 0;
      }

      .add-color-section button {
        width: auto;
        padding: 12px 24px;
      }

      table {
        font-size: 15px;
      }

      th,
      td {
        padding: 12px 10px;
      }

      .table-fixed th:nth-child(1),
      .table-fixed td:nth-child(1) {
        min-width: 150px;
      }

      .table-fixed th:nth-child(2),
      .table-fixed td:nth-child(2) {
        min-width: 160px;
      }

      .btn-delete-color {
        width: 32px;
        height: 32px;
        font-size: 20px;
      }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const container = document.getElementById('tablesContainer');
      const btnNovaTabela = document.getElementById('btnNovaTabela');

      btnNovaTabela.addEventListener('click', function () {
        criarTabela();
      });

      criarTabela();

      function criarTabela() {
        const card = document.createElement('div');
        card.className = 'card tabela-card';

        card.innerHTML = `
                    <div class="card-header">
                        <input type="text" class="model-title" placeholder="Nome do modelo">
                        <div class="size-inputs">
                            <div class="size-input-wrapper">
                                <label>P</label>
                                <span class="qty-control">
                                    <button type="button" class="btn-qty btn-dec" aria-label="Diminuir P">−</button>
                                    <input type="number" class="inp-p qty-input" value="0" min="0" placeholder="P">
                                    <button type="button" class="btn-qty btn-inc" aria-label="Aumentar P">+</button>
                                </span>
                            </div>
                            <div class="size-input-wrapper">
                                <label>M</label>
                                <span class="qty-control">
                                    <button type="button" class="btn-qty btn-dec" aria-label="Diminuir M">−</button>
                                    <input type="number" class="inp-m qty-input" value="0" min="0" placeholder="M">
                                    <button type="button" class="btn-qty btn-inc" aria-label="Aumentar M">+</button>
                                </span>
                            </div>
                            <div class="size-input-wrapper">
                                <label>G</label>
                                <span class="qty-control">
                                    <button type="button" class="btn-qty btn-dec" aria-label="Diminuir G">−</button>
                                    <input type="number" class="inp-g qty-input" value="0" min="0" placeholder="G">
                                    <button type="button" class="btn-qty btn-inc" aria-label="Aumentar G">+</button>
                                </span>
                            </div>
                            <div class="size-input-wrapper">
                                <label>GG</label>
                                <span class="qty-control">
                                    <button type="button" class="btn-qty btn-dec" aria-label="Diminuir GG">−</button>
                                    <input type="number" class="inp-gg qty-input" value="0" min="0" placeholder="GG">
                                    <button type="button" class="btn-qty btn-inc" aria-label="Aumentar GG">+</button>
                                </span>
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="btn-download">Baixar imagem</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-wrapper">
                        <table class="table-fixed">
                            <thead>
                                <tr>
                                    <th>Cor</th>
                                    <th>Tecidos</th>
                                    <th>P</th>
                                    <th>M</th>
                                    <th>G</th>
                                    <th>GG</th>
                                </tr>
                            </thead>
                            <tbody class="tabela-body"></tbody>
                            <tfoot>
                                <tr class="total-row">
                                    <td colspan="2">Total</td>
                                    <td class="total-p">0</td>
                                    <td class="total-m">0</td>
                                    <td class="total-g">0</td>
                                    <td class="total-gg">0</td>
                                </tr>
                                <tr class="grand-total-row">
                                    <td colspan="2">Total Geral</td>
                                    <td colspan="4" class="total-geral">0</td>
                                </tr>
                            </tfoot>
                        </table>
                        </div>
                    </div>
                    <div class="add-color-section">
                        <h3>Adicionar Cor</h3>
                        <label>Nome da Cor:</label>
                        <input type="text" class="nova-cor" placeholder="Cor">
                        <button class="btn-add-color">Adicionar</button>
                    </div>
                `;

        container.appendChild(card);

        const inputs = card.querySelectorAll('.size-inputs input[type="number"]');
        inputs.forEach(inp => inp.addEventListener('input', () => atualizarTabelaDoCard(card)));
        // Setup qty controls for size inputs
        card.querySelectorAll('.size-inputs .qty-control').forEach(ctrl => {
          setupQtyControl(ctrl, () => atualizarTabelaDoCard(card));
        });

        const btnAddColor = card.querySelector('.btn-add-color');
        btnAddColor.addEventListener('click', function () {
          adicionarCorNoCard(card);
        });

        const btnDownload = card.querySelector('.btn-download');
        btnDownload.addEventListener('click', function () {
          baixarImagemDoCard(card);
        });

        atualizarTabelaDoCard(card);
      }

      function obterTamanhosDoCard(card) {
        return {
          P: parseInt(card.querySelector('.inp-p').value) || 0,
          M: parseInt(card.querySelector('.inp-m').value) || 0,
          G: parseInt(card.querySelector('.inp-g').value) || 0,
          GG: parseInt(card.querySelector('.inp-gg').value) || 0
        };
      }

      function atualizarTabelaDoCard(card) {
        const tamanhos = obterTamanhosDoCard(card);
        const linhas = card.querySelectorAll('.tabela-body tr');
        const total = { P: 0, M: 0, G: 0, GG: 0 };

        linhas.forEach(linha => {
          const tecidoInput = linha.querySelector('input[type="number"]');
          if (!tecidoInput) return;
          const tecidos = parseInt(tecidoInput.value) || 1;
          linha.querySelector('.p').textContent = tamanhos.P * tecidos;
          linha.querySelector('.m').textContent = tamanhos.M * tecidos;
          linha.querySelector('.g').textContent = tamanhos.G * tecidos;
          linha.querySelector('.gg').textContent = tamanhos.GG * tecidos;
          total.P += tamanhos.P * tecidos;
          total.M += tamanhos.M * tecidos;
          total.G += tamanhos.G * tecidos;
          total.GG += tamanhos.GG * tecidos;
        });

        card.querySelector('.total-p').textContent = total.P;
        card.querySelector('.total-m').textContent = total.M;
        card.querySelector('.total-g').textContent = total.G;
        card.querySelector('.total-gg').textContent = total.GG;
        card.querySelector('.total-geral').textContent = total.P + total.M + total.G + total.GG;
      }

      function adicionarCorNoCard(card) {
        const inputCor = card.querySelector('.nova-cor');
        const nomeCor = (inputCor.value || '').trim();
        if (!nomeCor) return;
        const tbody = card.querySelector('.tabela-body');

        const tr = document.createElement('tr');
        tr.dataset.cor = nomeCor.toLowerCase();
        tr.innerHTML = `
                    <td>
                        <div class="color-name-cell">
                            <span>${nomeCor}</span>
                            <button type="button" class="btn-delete-color" aria-label="Deletar cor" title="Deletar cor">×</button>
                        </div>
                    </td>
                    <td>
                        <span class="qty-control">
                            <button type="button" class="btn-qty btn-dec" aria-label="Diminuir tecidos">−</button>
                            <input type="number" class="qty-input qty-tecido" min="1" value="1">
                            <button type="button" class="btn-qty btn-inc" aria-label="Aumentar tecidos">+</button>
                        </span>
                    </td>
                    <td class="p">0</td>
                    <td class="m">0</td>
                    <td class="g">0</td>
                    <td class="gg">0</td>
                `;

        tbody.appendChild(tr);

        const tecidoInput = tr.querySelector('.qty-tecido');
        tecidoInput.addEventListener('input', () => atualizarTabelaDoCard(card));
        setupQtyControl(tr.querySelector('.qty-control'), () => atualizarTabelaDoCard(card));

        // Adicionar evento de deletar cor
        const btnDelete = tr.querySelector('.btn-delete-color');
        btnDelete.addEventListener('click', function () {
          if (confirm(`Deseja realmente apagar a cor "${nomeCor}"?`)) {
            tr.remove();
            atualizarTabelaDoCard(card);
          }
        });

        inputCor.value = '';
        atualizarTabelaDoCard(card);
      }

      function setupQtyControl(containerEl, onChange) {
        const input = containerEl.querySelector('input[type="number"]');
        const btnDec = containerEl.querySelector('.btn-dec');
        const btnInc = containerEl.querySelector('.btn-inc');
        const min = input.min !== '' ? parseInt(input.min) : -Infinity;
        const step = input.step !== '' ? parseInt(input.step) : 1;
        btnDec.addEventListener('click', () => {
          const current = parseInt(input.value) || 0;
          const next = Math.max(min, current - step);
          input.value = next;
          onChange && onChange();
        });
        btnInc.addEventListener('click', () => {
          const current = parseInt(input.value) || 0;
          const next = current + step;
          input.value = next;
          onChange && onChange();
        });
      }

      function baixarImagemDoCard(card) {
        const titulo = (card.querySelector('.model-title').value || 'tabela').trim();
        const nomeArquivo = `${titulo || 'tabela'}.png`;
        const opt = { backgroundColor: '#ffffff', scale: 2 };
        html2canvas(card, opt).then(canvas => {
          const link = document.createElement('a');
          link.download = nomeArquivo;
          link.href = canvas.toDataURL('image/png');
          link.click();
        });
      }
    });
  </script>
</head>

<body>
  <div class="app-container">
    <div class="app-header">
      <h2>Tabelas de Cores e Tamanhos</h2>
    </div>
    <div class="app-actions">
      <button id="btnNovaTabela">Adicionar Nova Tabela</button>
    </div>
    <div id="tablesContainer" class="cards-grid"></div>
  </div>
</body>

</html>
